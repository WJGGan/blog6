---
weight: 5
title: "DAY2:存储系统"
date: 2023-11-21T02:48:04+08:00
lastmod: 2023-11-21T02:48:04+08:00
draft: false
author: "wjg"
authorLink: "https://dillonzq.com"
description: "408三轮归纳"
tags: ["408"]
categories: ["408"]
images: []
resources:
- name: "featured-image"
  src: "featured-image.jpg"
enableEmoji: true
toc:
  auto: false
twemoji: false
lightgallery: true
---

408三轮归纳DAY2
<!--more-->
- 概述：存储系统主要是从硬件层面描述计算机内的存储器有哪些，什么功能，怎么连接，如何工作的；其中需要记忆的部分为存储器的分类和外存磁盘（os中也有）的知识；另外Cache和多模存储器及虚拟存储器都是需要理解的部分，同时也是考试的重点，今天重点将细节的存储器知识做总结梳理并记忆。

- RAM和ROM的特点及应用
	- RAM：随机存取
		- SRAM
		- DRAM：需要刷新，破坏性读出，行列分两次送（地址复用
			- 集中刷新：存在死区
			- 分散刷新：一个T分两半（没有死区，加长了T
			- 异步刷新：t=T/行数（两者结合
			- 刷新以行为单位，对CPU透明
	- ROM：只读，也可以作为主存的一部分，随机访问
		- MROM：出厂写
		- PROM：一次性编程
		- EPROM：多次编程
		- FLASH：U盘
		- SSD：硬盘；随机访问
	- 串行访问存储器
		- 顺序存取：磁带
		- 直接存取：磁盘，光盘
- 区分存取周期=存取时间+恢复时间；T即完成一次独立读写所需的时间即两次独立访问存储器之间的最小时间间隔。
- *控制存储器*用来存放*微指令*，在CPU控制器内，用*ROM*实现；微程序控制器中存放微程序
- 芯片的引脚数目需要+1片选+2读写以及DRAM地址线复用+数据线
- 多模块存储器
	- 高位交叉（高位表示体号
	- 低位交叉（低位体号
		- 可以并行存取，提高了带宽
		- 模块号=单元地址%m
		- m=T/r(T为存取周期，r为传输周期)
		- 连续存取类似‘流水线’：存取m个字的时间为T+(m-1)r；流水线是指令流水线内容
		- 判断是否冲突，4次连续访问是否出现在同一模块
- MAR位数只与地址空间的大小有关，物理空间是迷惑信息
- 交叉编制涉及到存放问题，涉及存取周期，以及数据边界对齐存放等，需要画图理解
	- 数据边界对齐：单元地址要能够整除数据的大小，double除8,int除4，shor除2，char除1


***
- Cache
	- Cache的命中缺失替换过程由硬件实现；缺页处理通过软件完成，TLB缺失既可以用软件又可以用硬件实现
	- CPU与Cache以字为单位，Cache与主存以块为单位交换；
	- 映射方式
		- 直接：有行号
		- 全相联：只有tag和w
		- 组相联：有组号，每组有几行则为几路组相联，每组两行为2路组相联映射
	- 替换算法
		- LRU近期最少使用：命中的为0，其余+1，换3的
		- 最近不经常使用：访问一次+1，换出最小的
	- 写策略
		- Cache写命中
			- 全写法：随时保持一致
			- 回写法：设置脏位，若修改过则换出时写回
		- Cache不命中
			- 写分配法：写不命中时，将块从主存读入并更新
			- 非写分配法：只写入主存，不调块
	- 计算Cache命中率时注意读和写都是访问主存，别只算了一半
	- 指令Cache和数据Cache分离：减少指令流水线的资源冲突
	- 计算Cache行位数时，要判断是否要加入脏位和LRU位
***
- 外部存储器（磁盘、SSD等
	- 磁盘
		- 组成
			- 由磁盘驱动器（让它转），磁盘控制器（和主机的接口），盘片组成
			- 盘片对应磁头数，柱面对应磁道数
			- 磁道又分为*扇区（最小读写单位）*（多个相邻的扇区形成簇或叫块，一个簇只能存放一个文件的内容，因此文件的大小必须是簇的整数倍）
		- 数据传输率=rN，r为每秒多少转，N为每条磁道的字节数
		- 一次磁盘读写平均读取周期时间=t寻道+t延迟（t一圈/2）+ 
			$$
			t传输 = \frac{存取的字节数b}{r*一个磁道的字节数N}
			$$
		- RAID通过多个磁盘提高传输率，并行存取提高数据吞吐量，镜像提高安全性，数据校验提高容错能力
		- OS中涉及的内容
			- 初始化
				- 低级格式化（*物理*）
					- 划分扇区，写入一些必要的数据结构，初始化逻辑块号到扇区的映射
				- 分区：
					- 操作系统将其分区DE盘，将其记录到磁盘主引导记录的分区表中
					- *逻辑*格式化（建立文件系统），将空闲空间和已分配空间以及目录写入磁盘
				- ![[操作系统引导（开机）.png]]
			- 磁盘调度算法
				- FCFS：不会磁道黏着
				- 最短寻道时间优先：会饥饿
				- SCAN
				- C-SCAN
				- LOOK
				- C-LOOK
			- 提高传输效率
				- 交替编号
				- 错位命名
	- SSD
		- 闪存翻译层：将逻辑块的读写请求翻译成对物理块的控制信号，相当于磁盘控制器
		- 闪存分为多个芯片，芯片分为多块，块分为页，数据以页为单位读写，只有一页所属的块全部擦除后才能写这一页，即擦除以块为单位
